---
title: "FinalProject"
author: "Cole Maxwell"
date: "4/18/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(keras)
library(tensorflow)


#Loading a csv file
WineQualityDataFrame <- read.csv("WineQT.csv")

# Various syntax for R dataframes
summary(WineQualityDataFrame)

head(WineQualityDataFrame)

head(WineQualityDataFrame$quality)

```

## Splitting data into training and testing

```{r}
sample_size <- 120
set.seed(1234) # setting random seed to make results repeatable


# Subtract three to so quality levels start at zero
WineQualityDataFrame$quality <- WineQualityDataFrame$quality -3

picked <- sample(seq_len(nrow(WineQualityDataFrame)),size = sample_size)
training <- WineQualityDataFrame[picked,]
testing <- WineQualityDataFrame[-picked,]


# Changing y into categorical data (performing one-hot encoding)

yTr <- to_categorical(training$quality, num_classes = 6)
yTest <- to_categorical(testing$quality, num_classes = 6)

```

## Neural network for the iris example

```{r}

model = keras_model_sequential() %>%
  layer_dense(units = 64, activation = "relu",input_shape=(4)) %>%
  layer_dense(units = 64, activation = "relu") %>%
  layer_dense(units = ncol(yTr), activation = "softmax")


model %>% compile(
  loss = "categorical_crossentropy",
  optimizer = "adam", #optimizer_rmsprop(),
  metrics = "accuracy"
)

xTr <- as.matrix(training[,1:4]) # need to convert to a matrix
xTest <- as.matrix(testing[,1:4])

model %>% 
  fit(
    x = xTr, # input is the first 4 columns of the dataframe
    y = yTr, # label is the last column
    epochs = 20
  )

```

# Evaluate the model
```{r}
model %>% evaluate(xTest, yTest)

# Predicting likelihood of all categories:
result <- model %>% predict(xTest)

result

testing[,5]

```
